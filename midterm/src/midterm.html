<!DOCTYPE html>
<html>
    <meta charset="utf-8">

<!--  The lighting computation is based off this code: http://interactivecomputergraphics.com/Code/06/   -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 300 es
        precision mediump float;

        in vec4 aPosition;
        in vec4 aNormal;

        out vec4 vColor;

        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;

        uniform vec4 uAmbientProduct, uDiffuseProduct, uSpecularProduct;
        uniform vec4 uLightPosition;
        uniform float uShininess;
        uniform mat3 uNormalMatrix;


        void main()
        {
            vec3 pos = (uModelViewMatrix * aPosition).xyz;
            vec3 light = uLightPosition.xyz;
            vec3 L;

            // check for directional light

            if(uLightPosition.w == 0.0) L = normalize(uLightPosition.xyz);
            else L = normalize(uLightPosition.xyz - pos);

            vec3 E = -normalize(pos);
            vec3 H = normalize(L + E);

            // Transform vertex normal into eye coordinates


            vec3 N = normalize(uNormalMatrix*aNormal.xyz);

            // Compute terms in the illumination equation
            vec4 ambient = uAmbientProduct;

            float Kd = max( dot(L, N), 0.0 );
            vec4  diffuse = Kd*uDiffuseProduct;

            float Ks = pow( max(dot(N, H), 0.0), uShininess );
            vec4  specular = Ks * uSpecularProduct;

            if( dot(L, N) < 0.0 ) {
                 specular = vec4(0.0, 0.0, 0.0, 1.0);
            }

            gl_Position = uProjectionMatrix * uModelViewMatrix * aPosition;

            vColor = ambient + diffuse + specular;
            vColor.a = 1.0;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec4 vColor;
        out vec4 fColor;

        void main()
        {
            fColor = vColor;
        }
    </script>

    <script type="text/javascript" src="../Common/MVnew.js"></script>
    <script type="text/javascript" src="../Common/initShaders.js"></script>
    <script type="text/javascript" src="../Common/flatten.js"></script>

    <script type="text/javascript" src="gls.js"></script>
    <script type="text/javascript" src="Grid.js"></script>
    <script type="text/javascript" src="Entity.js"></script>
    <script type="text/javascript" src="midterm.js"></script>

    <style>
        .row {
            display: flex;
        }

        .column {
            flex: 50%;
        }
    </style>

    <body>
        <div class="row">
            <div class="column">
                <canvas id="gl-canvas" width="768" height="768">
                    Oops ... your browser doesn't support the HTML5 canvas element
                </canvas>
            </div>
            <div class="column">
                <h3>Lighting Options</h3>
                    <label for="toggle-light">Toggle Light</label>
                    <input type="checkbox" id="toggle-light" name="toggle-light" checked>
                    <br><br>
                    <label for="light-position-slider">Light Position</label>
                    <input class="bar" type="range" id="light-position-slider"
                           name="light-position-slider" min="0.0" max="6.205" value="0.765" step="0.017"/>
                    <br><br>
                    <button id="light-reset">Reset</button>
                <h3>Terrain Options</h3>
                    <label for="toggle-terrain">Toggle Terrain</label>
                    <input type="checkbox" id="toggle-terrain" name="toggle-terrain" checked>
                <h3>Flora Options</h3>
                    <label for="toggle-flora">Toggle Flora</label>
                    <input type="checkbox" id="toggle-flora" name="toggle-flora" checked>
                    <br><br>
                    <label for="production-rule-selection">Choose Production Rule: </label>
                    <select id="production-rule-selection" name="production-rule-selection">
                        <option value="default">default</option>
                        <option value="tall-light-density">tall light density</option>
                        <option value="tall-moderate-density">tall moderate density</option>
                        <option value="tall-heavy-density">tall heavy density</option>
                        <option value="natural-growth-1">natural growth 1</option>
                        <option value="natural-growth-2">natural growth 2</option>
                        <option value="natural-growth-3">natural growth 3</option>
                        <option value="3d-1">3D 1</option>
                        <option value="3d-2">3D 2</option>
                        <option value="3d-3">3D 3</option>
                        <option value="3d-4">3D 4</option>
                    </select>
                    <br><br>
                    <button id="grow">Grow</button> <button id="flora-reset">Reset</button>
                <h3>Wind Options</h3>
                    <label for="wind-slider">Wind Speed</label>
                    <input class="bar" type="range" id="wind-slider"
                           name="wind-slider" min="0.0" max="1.0" value="0.0" step="0.01"/>
            </div>
        </div>
        <br/>


    </body>
</html>
